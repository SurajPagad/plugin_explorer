<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>global.GetAppArtifacts</api_name>
        <caller_access/>
        <client_callable>true</client_callable>
        <description/>
        <name>GetAppArtifacts</name>
        <script><![CDATA[var GetAppArtifacts = Class.create();
GetAppArtifacts.prototype = Object.extendsObject(global.AbstractAjaxProcessor, {
    getAppArtifacts: function() {
        var appID = this.getParameter('sysparm_app_id');
        try {
            var inputs = {};
            inputs['app_id'] = appID; // String 
            var result = sn_fd.FlowAPI.getRunner().action('global.get_application_artifacts').inForeground().withInputs(inputs).run();
            var outputs = result.getOutputs();
            var response = outputs['response']; // JSON
            var resultObj = {};
            resultObj.artifacts = response.artifacts;
            resultObj.meta_data = response.metadata;
            resultObj.instance_name = gs.getProperty('instance_name');
            return JSON.stringify(resultObj);
        } catch (ex) {
            var message = ex.getMessage();
            gs.error(message);
        }
    },


    preprocess: function(artifacts) {
        artifacts.forEach(function(artifact, artifactIndex) {
            var artifactTypes = artifact.types ? artifact.types : [];
            artifactTypes.forEach(function(artifactType, artifactTypeIndex) {
                var metaDataFiles = artifactType.artifacts ? artifactType.artifacts : [];
                metaDataFiles.forEach(function(metaDataFile, metaDataFileIndex) {
                    var customized = false;
                    var audit = new GlideRecord('sys_audit');
                    audit.addQuery('documentkey', metaDataFileSysId);
                    audit.setLimit(1);
                    audit.query();
                    if (audit.hasNext())
                        customized = true;
                    else
                        customized = false;
                    //gs.info('customized ' + customized);
                    //artifacts[artifactIndex].types[artifactTypeIndex].artifacts[metaDataFileIndex].isCustomized = this.isCustomized(metaDataFile.sysId);
                    //metaDataFiles.isCustomized = 
                });
            });
        });
        return artifacts;
    },

    isCustomizedArtifact: function(metaDataFileSysId) {
        if (!metaDataFileSysId)
            return false;
        return true;
        //         gs.info('metaDataFilesysid ' + metaDataFileSysId);
        //         var audit = new GlideRecord('sys_audit');
        //         audit.addQuery('documentkey', metaDataFileSysId);
        //         audit.setLimit(1);
        //         audit.query();
        //         if (audit.hasNext())
        //             return true;
        //         else
        //             return false;
		
    },

    type: 'GetAppArtifacts'
});]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-07-27 09:41:30</sys_created_on>
        <sys_id>19b944c02fc11110916d50492799b66c</sys_id>
        <sys_mod_count>33</sys_mod_count>
        <sys_name>GetAppArtifacts</sys_name>
        <sys_package display_value="Table configuration" source="9c555b512f941110916d50492799b6fa">9c555b512f941110916d50492799b6fa</sys_package>
        <sys_policy/>
        <sys_scope display_value="Plugin Explorer">a38bf21c2f891110916d50492799b605</sys_scope>
        <sys_update_name>sys_script_include_19b944c02fc11110916d50492799b66c</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2023-01-07 07:32:16</sys_updated_on>
    </sys_script_include>
    <sys_claim action="INSERT_OR_UPDATE">
        <claim_owner_scope display_value="Plugin Explorer">a38bf21c2f891110916d50492799b605</claim_owner_scope>
        <claim_timestamp>1858b2501490000001</claim_timestamp>
        <metadata_update_name>sys_script_include_19b944c02fc11110916d50492799b66c</metadata_update_name>
        <previous_claim_app_version>1.0.0</previous_claim_app_version>
        <previous_claim_name>Plugin Explorer</previous_claim_name>
        <previous_claim_scope>a38bf21c2f891110916d50492799b605</previous_claim_scope>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2023-01-07 07:32:16</sys_created_on>
        <sys_id>a95150302f5825103df358492799b65d</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2023-01-07 07:32:16</sys_updated_on>
    </sys_claim>
    <sys_claim action="INSERT_OR_UPDATE">
        <claim_owner_scope display_value="Plugin Explorer">a38bf21c2f891110916d50492799b605</claim_owner_scope>
        <claim_timestamp>1858b2501410000001</claim_timestamp>
        <metadata_update_name>sys_script_include_19b944c02fc11110916d50492799b66c</metadata_update_name>
        <previous_claim_app_version>1.0.0</previous_claim_app_version>
        <previous_claim_name>Table configuration</previous_claim_name>
        <previous_claim_scope>9c555b512f941110916d50492799b6fa</previous_claim_scope>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2023-01-07 07:32:16</sys_created_on>
        <sys_id>6d5150302f5825103df358492799b65d</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2023-01-07 07:32:16</sys_updated_on>
    </sys_claim>
</record_update>
